<!doctype html>
<html lang="en">
<head>
<title>NNsight and NDIF: Democratizing Access to Open-Weight Foundation Model Internals</title>
<meta name="viewport" content="width=device-width,initial-scale=1" />
<meta name="description" content="Enabling transparent access to large neural network internals through a unified framework for interpretability research." />
<meta property="og:title" content="NNsight and NDIF: Democratizing Access to Open-Weight Foundation Model Internals" />
<meta property="og:description" content="Enabling transparent access to large neural network internals through a unified framework for interpretability research." />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" /> 
<meta name="twitter:title" content="NNsight and NDIF: Democratizing Access to Open-Weight Foundation Model Internals" />
<meta name="twitter:description" content="Enabling transparent access to large neural network internals through a unified framework for interpretability research." />
<link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">
<link rel="manifest" href="/site.webmanifest">

<link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-rwoIResjU2yc3z8GV/NPeZWAv56rSmLldC3R/AZzGRnGxQQKnKkoFVhFQhNUwEyJ" crossorigin="anonymous">
<script src="https://code.jquery.com/jquery-3.2.1.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Math&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,700" rel="stylesheet">
<link href="style.css" rel="stylesheet">

<style>
.relatedthumb {
  float:left; width: 200px; margin: 3px 10px 7px 0;
}
.relatedblock {
  clear: both;
  display: inline-block;
}
.bold-sc {
  font-variant: small-caps;
  font-weight: bold;
}
.cite, .citegroup {
  margin-bottom: 8px;
}
:target {
  background-color: yellow;
}
</style>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-FD12LWN557"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date()); gtag('config', 'G-FD12LWN557');
</script>

</head>
<body class="nd-docs">
<div class="nd-pageheader">
 <div class="container">
 <h1 class="lead">
 NNsight and
 <nobr class="widenobr">NDIF:</nobr>
 Democratizing Access to 
 <nobr class="widenobr">Open-Weight Foundation Model Internals</nobr>
 </h1>
<address>
  <nobr><a href="https://github.com/jadenfiotto-kaufman" target="_blank">Jaden Fiotto-Kaufman</a><sup>1*</sup>,</nobr>
  <nobr><a href="https://github.com/alexander-loftus" target="_blank">Alexander R. Loftus</a><sup>1*</sup>,</nobr>
  <nobr><a href="https://erictodd.ai/" target="_blank">Eric Todd</a><sup>1</sup>,</nobr>
  <nobr><a href="https://jannikbrinkmann.github.io/" target="_blank">Jannik Brinkmann</a><sup>1,2</sup>,</nobr>
  <nobr><a href="https://github.com/koyena" target="_blank">Koyena Pal</a><sup>1</sup>,</nobr>
  <nobr>Dmitrii Troitskii<sup>1</sup>,</nobr>
  <nobr>Michael Ripa<sup>1</sup>,</nobr>
  <nobr>Adam Belfki<sup>1</sup>,</nobr>
  <nobr><a href="https://github.com/canrager" target="_blank">Can Rager</a><sup>3</sup>,</nobr>
  <nobr>Caden Juang<sup>1</sup>,</nobr>
  <nobr><a href="https://aaronmueller.github.io/" target="_blank">Aaron Mueller</a><sup>1</sup>,</nobr>
  <nobr><a href="https://github.com/sam-marks" target="_blank">Samuel Marks</a><sup>1</sup>,</nobr>
  <nobr>Arnab Sen Sharma<sup>1</sup>,</nobr>
  <nobr>Francesca Lucchetti<sup>1</sup>,</nobr>
  <nobr>Nikhil Prakash<sup>1</sup>,</nobr>
 <br>
  <nobr>Carla Brodley<sup>1</sup>,</nobr>
  <nobr>Arjun Guha<sup>1</sup>,</nobr>
  <nobr>Jonathan Bell<sup>1</sup>,</nobr>
  <nobr>Byron C. Wallace<sup>1</sup>,</nobr>
  <nobr><a href="https://baulab.info/" target="_blank">David Bau</a><sup>1</sup></nobr>
 <br>
  <nobr><sup>1</sup><a href="https://khoury.northeastern.edu/" target="_blank">Northeastern University</a></nobr>,
  <nobr><sup>2</sup><a href="https://www.tu-clausthal.de/en/" target="_blank">TU Clausthal</a></nobr>,
  <nobr><sup>3</sup><a href="https://www.uni-hamburg.de/en.html" target="_blank">University of Hamburg</a></nobr>
  <br><nobr><sup>*</sup>Equal contribution</nobr>

</address>
 </div>
</div><!-- end nd-pageheader -->

<div class="container">
<div class="row justify-content-center text-center">

<p>
<a href="https://arxiv.org/abs/2407.14561" class="d-inline-block p-3 align-top" target="_blank"><img height="100" width="78" src="images/paper-thumb.png" style="border:1px solid; margin: 0 38px;" alt="ArXiv Preprint thumbnail" data-nothumb=""><br>ArXiv<br>Preprint</a>
<a href="https://github.com/ndif-team/nnsight" class="d-inline-block p-3 align-top" target="_blank"><img height="100" width="78" src="images/code-thumb.png" style="border:1px solid; margin: 0 38px;" alt="Github code thumbnail" data-nothumb=""><br>NNsight<br>GitHub</a>
<a href="https://github.com/ndif-team/ndif" class="d-inline-block p-3 align-top" target="_blank"><img height="100" width="78" src="images/code-thumb.png" style="border:1px solid; margin: 0 38px;" alt="Github code thumbnail" data-nothumb=""><br>NDIF<br>GitHub</a>
<a href="https://nnsight.net" class="d-inline-block p-3 align-bottom" target="_blank"><img height="78" width="134" src="images/demo3x4-ndif.png" style="border:1px solid" alt="NNsight website thumbnail" data-nothumb=""><br>NDIF<br>Website</a>
<a href="https://nnsight.net" class="d-inline-block p-3 align-bottom" target="_blank"><img height="78" width="104" src="images/demo3x4-thumb.png" style="border:1px solid" alt="NNsight website thumbnail" data-nothumb=""><br>NNsight<br>Website</a>
</p>

<div class="card" style="max-width: 1020px;">
<div class="card-block">
<h3>How can we probe models that are too big to run?</h3>
<p>
Researchers studying large-scale AI systems face major engineering challenges: lack of transparent access to model internals, limited computational resources, and a significant engineering overhead required to run experiments.
</p>
<p>
We introduce <b>NDIF</b>, a shared inference infrastructure that separates experiments from engineering code, allowing researchers to design experiments using pytorch-like syntax with no engineering burden. This syntax is executed with <b>NNsight</b>, an open-source PyTorch extension that extends the language with model internals access and a flexible, expressive API. Experiments are represented, stored, and executed using a novel <b>intervention graph</b> framework that modifies the model's computation graph.
</p>



</p>
</div><!--card-block-->
</div><!--card-->

</div><!--row-->
  
<div class="row">
<div class="col">
  
<figure class="center_image" style="margin-top: 30px">
  <center><img src="images/paper/intervention_graph_fig.png" style="width:100%; max-width:800px"></center>
  <figcaption>An example of the implementation of an NNsight intervention graph: (a) A user writes research code from which (b) an intervention graph is constructed. (c) The intervention operations are interleaved with the original model's computation and then executed. Values marked with .save() are made available to the user upon completion.
  </figcaption>
</figure>

<h2>Why is research on foundation model internals important?</h2>
<p>As AI models grow in scale and capability, understanding their inner workings becomes increasingly critical for safety, reliability, and scientific progress. However, our analysis reveals a growing gap between the most capable models and those being studied in detail. While many interpretability researchers have access to open-weight models like Llama 3.1 405B, the technical complexity and computational requirements of working with such large models create substantial barriers.</p>

<figure class="center_image" style="margin-top: 30px">
  <center><img src="images/paper/scatterplot_v2.png" style="width:100%; max-width:800px"></center>
  <figcaption>Most interpretability research is done on models that lag far behind the capabilities available in either closed- or open-models. There is a significant gap between the performance of models studied (blue line) and the capabilities of leading open-weight models (shown in orange). This gap is extended even further when considering the performance of leading closed-weight models (black line).
  </figcaption>
</figure>

<h2>How does the intervention graph architecture work?</h2>
<p>The intervention graph represents experiments as a portable, serializable computational graph that can be transmitted, optimized, and executed independently from the underlying model deployment. This separation of experimental design from engineering implementation allows researchers to focus on scientific questions rather than operational challenges.</p>

<p>Interventions are modifications to the model's computation graph that introduce additional nodes and edges. By carefully introducing these additional nodes and edges, the intervention graph defines how these modifications interact with the original model's forward and backward pass. This enables a wide range of experiments, from simple activation probing to complex causal interventions.</p>



<h2>What is NNsight?</h2>
<p>NNsight is an open-source library that extends PyTorch to create a familiar yet powerful API for neural network interventions. By using deferred execution within a tracing context, NNsight allows researchers to define complex experiments using standard PyTorch syntax. The experiment is represented as an intervention graph that can be executed locally or sent to a remote service.</p>

<figure class="center_image" style="margin-top: 30px">
  <center><img src="images/paper/nnsight_code_comparison_red-crop.png" style="width:120%; max-width:900px"></center>
  <figcaption>Experiment code expressed using (a) standard PyTorch hooks and (b) the NNsight API. Both code snippets define the same intervention, but the NNsight version is more concise and expressive, allowing all module inputs and outputs to be accessed within a single trace context.
  </figcaption>
</figure>



<p>The key features of NNsight include:</p>
<ul>
  <li>Familiar PyTorch syntax for defining model interventions</li>
  <li>Support for all fundamental PyTorch operations</li>
  <li>Access to intermediate activations, gradients, and model parameters</li>
  <li>Compatibility with custom neural network architectures</li>
  <li>Seamless transition between local and remote execution</li>
</ul>

Documentation and more information can be found on the <a href="https://nnsight.net" target="_blank">NNsight website</a>.

<h2>What is NDIF?</h2>
<p>The National Deep Inference Fabric (NDIF) is a scalable inference service designed to execute intervention graphs on large, preloaded models. NDIF allows multiple researchers to share computational resources, dramatically reducing the cost and complexity of working with large-scale AI models.</p>

<figure class="center_image" style="margin-top: 30px">
  <center><img src="images/paper/system_design2.png" style="width:100%; max-width:800px"></center>
  <figcaption>
    System architecture overview: Researchers write experiments using NNsight, which creates an intervention graph that's sent to the NDIF service. NDIF hosts models across multiple GPUs, with weights distributed using tensor parallelism for very large models like Llama 3.1 405B. The intervention is executed across all model shards, results are gathered, and returned to the researcher's local environment. This architecture enables efficient sharing of computational resources while maintaining a simple interface for researchers.
  </figcaption>
</figure>


<p>NDIF's architecture provides several advantages over traditional approaches:</p>
<ul>
  <li>Minimized communication overhead compared to peer-to-peer systems like Petals</li>
  <li>Efficient resource sharing across multiple users</li>
  <li>Support for safe co-tenancy of user experiments</li>
  <li>Horizontal scaling and dynamic resource allocation</li>
  <li>Support for distributed model execution across multiple GPUs</li>
</ul>

More information and access details can be found on the <a href="https://nnsight.net" target="_blank">NDIF website</a>.

<h2>Performance and Evaluation</h2>
<p>We evaluated the performance of NNsight and NDIF in comparison with existing tools for model interpretation and remote execution. Our results show that:</p>

<figure class="center_image" style="margin-top: 30px">
  <div style="display: flex; justify-content: center; gap: 20px;">
    <div style="flex: 1; max-width: 300px;">
      <img src="images/paper/local_vs_remote_loading_time.png" style="width:100%;">
    </div>
    <div style="flex: 1; max-width: 300px;">
      <img src="images/paper/petals_small.png" style="width:100%;">
    </div>
  </div>
  <figcaption>
    <strong>Left:</strong> HPC vs. NDIF. We compare the time required to set up the model when NNsight is executed on an HPC node and an NDIF server. For HPC execution, the model must be loaded, so the setup time scales nearly linearly with model size. In contrast, remote execution with NDIF bypasses loading weights.
    <strong>Right:</strong> Petals vs. NDIF. We compare NDIF against Petals, an open-source remote inference framework. We find that the libraries demonstrate comparable performance for standard remote inference, but that NDIF significantly outperforms Petals for remote interventions.
  </figcaption>
</figure>

<p>For large models, NDIF provides substantial performance improvements over traditional HPC approaches, with minimal overhead compared to local execution. When compared to Petals, another open-source remote inference framework, NDIF shows comparable performance for standard inference but significantly outperforms it for intervention tasks due to reduced communication overhead.</p>

<h2>How to cite</h2>

<p>The paper can be cited as follows:
</p>

<div class="card">
<h3 class="card-header">bibliography</h3>
<div class="card-block">
<p style="text-indent: -3em; margin-left: 3em;" class="card-text clickselect">
Jaden Fiotto-Kaufman*, Alexander R. Loftus*, Eric Todd, Jannik Brinkmann, Koyena Pal, Dmitrii Troitskii, Michael Ripa, Adam Belfki, Can Rager, Caden Juang, Aaron Mueller, Samuel Marks, Arnab Sen Sharma, Francesca Lucchetti, Nikhil Prakash, Carla Brodley, Arjun Guha, Jonathan Bell, Byron C. Wallace, David Bau. "<em>NNsight and NDIF: Democratizing Access to Open-Weight Foundation Model Internals.</em>"
International Conference on Learning Representations (ICLR) 2025.
</p>
</div>
<h3 class="card-header">bibtex</h3>
<div class="card-block">
<pre class="card-text clickselect">
@inproceedings{fiotto-kaufman2025nnsight,
  title={NNsight and NDIF: Democratizing Access to Open-Weight Foundation Model Internals},
  author={Fiotto-Kaufman, Jaden and Loftus, Alexander R. and Todd, Eric and Brinkmann, Jannik and Pal, Koyena and Troitskii, Dmitrii and Ripa, Michael and Belfki, Adam and Rager, Can and Juang, Caden and Mueller, Aaron and Marks, Samuel and Sharma, Arnab Sen and Lucchetti, Francesca and Prakash, Nikhil and Brodley, Carla and Guha, Arjun and Bell, Jonathan and Wallace, Byron C. and Bau, David},
  booktitle={International Conference on Learning Representations},
  year={2025}
}
</pre>
</div>
</div>
</p>

</div>
</div><!--row -->
</div> <!-- container -->

<footer class="nd-pagefooter">
  <div class="row">
    <div class="col-6 col-md text-center">
      <a href="https://baulab.info/">About the Bau Lab</a>
    </div>
  </div>
</footer>

</body>
<script>
$(document).on('click', '.clickselect', function(ev) {
  var range = document.createRange();
  range.selectNodeContents(this);
  var sel = window.getSelection();
  sel.removeAllRanges();
  sel.addRange(range);
});
</script>
</html>
